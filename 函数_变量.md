# 变量
## 栈帧
```python
def dfs(p, q, k):
            nonlocal ans  # 关键：声明ans是外层函数的变量
            # 1. 提前终止：已找到答案或越界
            if ans or p < 0 or p >= m or q < 0 or q >= n:
                return
            # 2. 终止条件：匹配完所有字符（k == z）
            if k == z:
                ans = True
                return
            # 3. 匹配当前字符：不匹配则直接返回
            if board[p][q] != word[k]:
                return
            
            # 4. 标记已访问（回溯核心：避免重复访问）
            temp = board[p][q]
            board[p][q] = '#'  # 改成特殊字符，标记为已访问
            
            # 5. 向四个方向递归（无需提前判断边界，开头已校验）
            dfs(p, q+1, k+1)  # 右
            dfs(p, q-1, k+1)  # 左
            dfs(p+1, q, k+1)  # 下
            dfs(p-1, q, k+1)  # 上
            
            # 6. 回溯：恢复原字符（撤销标记）
            board[p][q] = temp
```
- Python 中，每调用一次函数（包括递归调用），都会在「调用栈」中创建一个新的「栈帧」
- 每次递归调用 dfs 都会创建一个独立的「函数执行栈帧」，temp 是每个栈帧内的局部变量，仅属于当前调用实例，不同栈帧的 temp 互不干扰。
## 变量作用域层级

```python
class Solution:
    def exist(self, board: List[List[str]], word: str) -> bool:
        m,n,z,ans = len(board),len(board[0]),len(word),False
        def dfs(p,q,k):
            nonlocal ans
            if k == z:
                ans = True
                return
            if ans or p < 0 or p >= m or q < 0 or q >= n:
                return
            if board[p][q] != word[k]:
                return
            temp = board[p][q]
            board[p][q] = '#'
            dfs(p, q+1, k+1)
            dfs(p, q-1, k+1)
            dfs(p+1, q, k+1)
            dfs(p-1, q, k+1)
            board[p][q] = temp
        for i in range(m):
            for j in range(n):
                dfs(i,j,0)
                if ans:
                    return True
        return ans
```

- 变量的 “读取” 和 “修改” 是两回事：读取变量时按 LEGB 规则查找；但 修改变量时，默认只能修改当前作用域的变量（除非用 nonlocal/global 声明）。
- “赋值即声明” 原则：如果在一个函数内部给变量赋值（如 ans = True），Python 会默认把这个变量当成「当前函数的局部变量」（L 层级），无论外层是否有同名变量。

| 作用域层级 | 英文缩写 | 含义（结合你的代码） | 示例 |
|------------|----------|----------------------|------|
| 局部作用域 | L（Local） | 函数/类内部定义的变量，仅当前函数可用 | `dfs` 里的 `p、q、k`；`exist` 里的 `m、n、z、ans` |
| 嵌套外层作用域 | E（Enclosing） | 嵌套函数的外层函数局部变量（父函数局部变量） | `exist` 里的 `ans` 相对于 `dfs` 就是「嵌套外层变量」 |
| 全局作用域 | G（Global） | 模块（.py 文件）级别定义的变量，整个模块可用 | 在 `class Solution` 外定义的变量（如 `a = 10`） |
| 内置作用域 | B（Built-in） | Python 内置的变量/函数（如 `print、len`） | 无需定义直接使用的 `len()`、`True` 等 |
## nonlocal/global 用法

修改「非当前作用域」的变量，必须用关键字声明：
- 修改「嵌套外层作用域（E）的局部变量」→ 用 nonlocal；
- 修改「全局作用域（G）的变量」→ 用 global；
- 局部变量（L）→ 直接赋值即可，无需声明。
